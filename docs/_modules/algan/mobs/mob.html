<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>algan.mobs.mob - Algan v0.1.0</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=18161cd7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-content-foreground: #000000;
  --color-background-primary: #ffffff;
  --color-background-border: #ffffff;
  --color-sidebar-background: #f8f9fb;
  --color-brand-content: #1c00e3;
  --color-brand-primary: #192bd0;
  --color-link: #c93434;
  --color-link--hover: #5b0000;
  --color-inline-code-background: #f6f6f6;;
  --color-foreground-secondary: #000;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-content-foreground: #ffffffd9;
  --color-background-primary: #131416;
  --color-background-border: #303335;
  --color-sidebar-background: #1a1c1e;
  --color-brand-content: #2196f3;
  --color-brand-primary: #007fff;
  --color-link: #51ba86;
  --color-link--hover: #9cefc6;
  --color-inline-code-background: #262626;
  --color-foreground-secondary: #ffffffd9;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-content-foreground: #ffffffd9;
  --color-background-primary: #131416;
  --color-background-border: #303335;
  --color-sidebar-background: #1a1c1e;
  --color-brand-content: #2196f3;
  --color-brand-primary: #007fff;
  --color-link: #51ba86;
  --color-link--hover: #9cefc6;
  --color-inline-code-background: #262626;
  --color-foreground-secondary: #ffffffd9;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Algan v0.1.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/manim-logo-sidebar.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/manim-logo-sidebar-dark.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Algan v0.1.0</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../installation.html">Installation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Installation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/uv.html">Installing Algan locally</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorials_guides.html">Tutorials &amp; Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Tutorials &amp; Guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../tutorials/installation.html">Installation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Installation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../installation/uv.html">Installing Algan locally</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/getting_started.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/basic_animations.html">Basic Animations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/controlling_animations.html">Controlling Animations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/nesting_mobs.html">Nesting Mobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/importing_from_manim.html">Importing From Manim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/extending_algan.html">Extending Algan</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../manim_user_quickstart/index.html">Manim User Quickstart</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Manim User Quickstart</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../manim_user_quickstart/manim_user_quickstart.html">Manim User Quickstart</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../reference.html">Reference Manual</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Reference Manual</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../reference_index/mobs.html">Mobs</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Mobs</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.mob.html">mob</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of mob</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.mob.Mob.html">Mob</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.group.html">group</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of group</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.group.Group.html">Group</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.text.html">text</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of text</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.text.Tex.html">Tex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.text.Text.html">Text</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.bezier_circuit.html">bezier_circuit</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of bezier_circuit</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.bezier_circuit.BezierCircuitCubic.html">BezierCircuitCubic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.bezier_circuit.BezierCurveCubic.html">BezierCurveCubic</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.html">shapes_2d</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of shapes_2d</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.Circle.html">Circle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.Polygon.html">Polygon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.Quad.html">Quad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.QuadTriangulated.html">QuadTriangulated</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.Rectangle.html">Rectangle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.RegularPolygon.html">RegularPolygon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.Square.html">Square</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.Triangle.html">Triangle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.TriangleTriangulated.html">TriangleTriangulated</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_2d.TriangleVertices.html">TriangleVertices</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.surfaces.surface.html">surface</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of surface</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.surfaces.surface.Surface.html">Surface</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.shapes_3d.html">shapes_3d</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of shapes_3d</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_3d.Cylinder.html">Cylinder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.shapes_3d.Sphere.html">Sphere</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.manim_mob.html">manim_mob</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of manim_mob</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.manim_mob.ManimMob.html">ManimMob</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.mobs.numeric_display.html">numeric_display</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of numeric_display</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.mobs.numeric_display.NumericDisplay.html">NumericDisplay</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../reference_index/animation.html">Animation</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Animation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.animation.animatable.html">animatable</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of animatable</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animatable.Animatable.html">Animatable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animatable.AnimatableData.html">AnimatableData</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animatable.ModificationHistory.html">ModificationHistory</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.html">animation_contexts</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of animation_contexts</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.AnimationContext.html">AnimationContext</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.AnimationManager.html">AnimationManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.ComposeRateFunc.html">ComposeRateFunc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.Lag.html">Lag</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.NoExtra.html">NoExtra</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.Off.html">Off</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.OnInit.html">OnInit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.RateFuncWrapper.html">RateFuncWrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.Seq.html">Seq</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.SlideShow.html">SlideShow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.animation.animation_contexts.Sync.html">Sync</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../reference_index/rendering.html">Rendering</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of Rendering</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.rendering.camera.html">camera</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of camera</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.rendering.camera.Camera.html">Camera</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.rendering.primitives.primitive.html">primitive</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of primitive</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.rendering.primitives.primitive.RenderPrimitive.html">RenderPrimitive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.rendering.primitives.primitive.RenderPrimitive2D.html">RenderPrimitive2D</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.rendering.primitives.triangle.html">triangle</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of triangle</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.rendering.primitives.triangle.PolygonPrimitive.html">PolygonPrimitive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.rendering.primitives.triangle.TrianglePrimitive.html">TrianglePrimitive</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.rendering.primitives.bezier_circuit_with_border_then_fill.html">bezier_circuit_with_border_then_fill</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of bezier_circuit_with_border_then_fill</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.rendering.primitives.bezier_circuit_with_border_then_fill.BezierCircuitPrimitiveWithBorderFillRendering.html">BezierCircuitPrimitiveWithBorderFillRendering</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../reference_index/scenes.html">Scenes</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of Scenes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/algan.scene.html">scene</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of scene</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.scene.Scene.html">Scene</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/algan.scene.SceneTracker.html">SceneTracker</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../reference_index/utils.html">Utils</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of Utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/algan.utils.algan_utils.html">algan_utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/algan.utils.animation_utils.html">animation_utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/algan.utils.tensor_utils.html">tensor_utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/algan.utils.python_utils.html">python_utils</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for algan.mobs.mob</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">linear_sum_assignment</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">algan.animation.animatable</span><span class="w"> </span><span class="kn">import</span> <span class="n">Animatable</span><span class="p">,</span> <span class="n">animated_function</span><span class="p">,</span> <span class="n">ModificationHistory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">algan.animation.animation_contexts</span><span class="w"> </span><span class="kn">import</span> <span class="n">Seq</span><span class="p">,</span> <span class="n">Off</span><span class="p">,</span> <span class="n">Sync</span><span class="p">,</span> <span class="n">AnimationContext</span><span class="p">,</span> <span class="n">NoExtra</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">algan.constants.spatial</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">algan.geometry.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">rotate_vector_around_axis</span><span class="p">,</span> <span class="n">get_rotation_between_3d_vectors</span><span class="p">,</span> <span class="n">project_point_onto_line</span><span class="p">,</span> <span class="n">get_rotation_around_axis</span><span class="p">,</span> <span class="n">map_global_to_local_coords</span><span class="p">,</span> <span class="n">map_local_to_global_coords</span><span class="p">,</span> \
    <span class="n">get_rotation_between_bases</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">algan.constants.rate_funcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">ease_out_exp</span><span class="p">,</span> <span class="n">inversed</span><span class="p">,</span> <span class="n">identity</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">algan.defaults.style_defaults</span><span class="w"> </span><span class="kn">import</span> <span class="n">DEFAULT_BUFFER</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">algan.utils.animation_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">animate_lagged_by_location</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">algan.utils.python_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">traverse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">algan.utils.tensor_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">dot_product</span><span class="p">,</span> <span class="n">broadcast_gather</span><span class="p">,</span> <span class="n">unsqueeze_right</span><span class="p">,</span> <span class="n">unsquish</span><span class="p">,</span> <span class="n">squish</span><span class="p">,</span> <span class="n">broadcast_cross_product</span><span class="p">,</span> <span class="n">cast_to_tensor</span>


<div class="viewcode-block" id="Mob">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Mob</span><span class="p">(</span><span class="n">Animatable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all objects that have a location and orientation in 3d space.</span>

<span class="sd">    A Mob is an Animatable that exists in a 3D scene,</span>
<span class="sd">    possessing properties like location, orientation (basis), and color.</span>
<span class="sd">    It can have child Mobs, forming a hierarchy, and supports various</span>
<span class="sd">    transformations and animations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    location: Tensor[*,3]</span>
<span class="sd">        Location in 3D world space.</span>
<span class="sd">    basis: Tensor[*,9]</span>
<span class="sd">        Flattened 3x3 matrix in which the rows specify the</span>
<span class="sd">        right, upwards, and forwards directions for this mob&#39;s orientation, and the row norms</span>
<span class="sd">        represent the mob&#39;s scale in those directions. Defaults to identify matrix.</span>
<span class="sd">    color</span>
<span class="sd">        The color of the Mob. If None, uses `get_default_color()`. Defaults to None.</span>
<span class="sd">    opacity</span>
<span class="sd">        The maximum opacity of the Mob (0.0 to 1.0). Defaults to 1.</span>
<span class="sd">    glow</span>
<span class="sd">        The glow intensity of the Mob. Defaults to 0.</span>
<span class="sd">    *args</span>
<span class="sd">        Additional arguments for the Animatable base class.</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Additional keyword arguments for the Animatable base class.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. algan:: Example1Mob</span>

<span class="sd">        from algan import *</span>

<span class="sd">        square = Square().spawn()</span>
<span class="sd">        square.move(LEFT)</span>

<span class="sd">        render_to_file()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="o">=</span><span class="n">ORIGIN</span><span class="p">,</span> <span class="n">basis</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="o">=</span><span class="n">squish</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="p">:</span><span class="n">Color</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">glow</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_attrs_as_animatable</span><span class="p">({</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;basis&#39;</span><span class="p">,</span> <span class="s1">&#39;scale_coefficient&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="s1">&#39;max_opacity&#39;</span><span class="p">,</span> <span class="s1">&#39;glow&#39;</span><span class="p">},</span> <span class="n">Mob</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr_to_relations</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">additive</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr_to_relations</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">additive</span><span class="p">,</span>
                                       <span class="c1">#&#39;glow&#39;: additive,</span>
                                  <span class="s1">&#39;basis&#39;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">squish</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">@</span> <span class="n">unsquish</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">squish</span><span class="p">(</span><span class="n">get_rotation_between_bases</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">unsquish</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
                                       <span class="s1">&#39;scale_coefficient&#39;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">),</span>
                                                             <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">squish</span><span class="p">((</span><span class="n">unsquish</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">/</span>
                                                                                  <span class="n">unsquish</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">())),</span> <span class="mi">3</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_color</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_opacity</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">opacity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glow</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">glow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_points_per_object</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="Mob.reset_basis">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.reset_basis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resets the Mob&#39;s basis to the identity matrix (no rotation, unit scale).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">squish</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))))</span></div>


<div class="viewcode-block" id="Mob.register_attrs_as_animatable">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.register_attrs_as_animatable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_attrs_as_animatable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">my_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers attributes as animatable, meaning their changes can be tracked</span>
<span class="sd">        and interpolated over time.</span>

<span class="sd">        This method dynamically creates property getters and setters for the</span>
<span class="sd">        specified attributes if they don&#39;t already exist.</span>

<span class="sd">        Args:</span>
<span class="sd">            attrs (iterable[str] or str): A collection of attribute names (or a single</span>
<span class="sd">                attribute name) to register as animatable.</span>
<span class="sd">            my_class (type, optional): The class to which the property getters</span>
<span class="sd">                and setters should be attached. Defaults to the current Mob&#39;s class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">attrs</span><span class="p">,}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;animatable_attrs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animatable_attrs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">my_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">my_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_property_getter_and_setter</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">my_class</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animatable_attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.add_property_getter_and_setter">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.add_property_getter_and_setter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_property_getter_and_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">property_name</span><span class="p">,</span> <span class="n">class_to_attach_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically adds a property with a getter and setter for a given attribute name.</span>

<span class="sd">        The getter will retrieve the animated value of the attribute.</span>
<span class="sd">        The setter will set the absolute value of the attribute, recording the change</span>
<span class="sd">        for animation.</span>

<span class="sd">        Args:</span>
<span class="sd">            property_name (str): The name of the property to create.</span>
<span class="sd">            class_to_attach_to (type, optional): The class to which this property</span>
<span class="sd">                will be added. Defaults to the current Mob&#39;s class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">class_to_attach_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">class_to_attach_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">class_to_attach_to</span><span class="p">,</span> <span class="n">property_name</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="nd">@property</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getattribute_animated</span><span class="p">(</span><span class="n">property_name</span><span class="p">)</span>

        <span class="nd">@prop</span><span class="o">.</span><span class="n">setter</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setattr_absolute</span><span class="p">(</span><span class="n">property_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">class_to_attach_to</span><span class="p">,</span> <span class="n">property_name</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.get_descendants">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.get_descendants">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_self</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all descendant Mobs in the hierarchy, optionally including self.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_self (bool, optional): Whether to include the current Mob</span>
<span class="sd">                in the returned list. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[Mob]: A flat list of descendant Mobs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">traverse</span><span class="p">([</span><span class="o">*</span><span class="p">([</span><span class="bp">self</span><span class="p">]</span> <span class="k">if</span> <span class="n">include_self</span> <span class="k">else</span> <span class="p">[]),</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]]))</span></div>


<div class="viewcode-block" id="Mob.set_time_inds_to">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.set_time_inds_to">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_time_inds_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mob</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Synchronizes the animation time indices of this Mob with another Mob.</span>

<span class="sd">        This is used internally to ensure consistent animation states between</span>
<span class="sd">        mobs in a hierarchy.</span>

<span class="sd">        Args:</span>
<span class="sd">            mob (Mob): The Mob whose time indices will be copied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_inds</span> <span class="o">=</span> <span class="n">mob</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time_inds_materialized</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time_inds</span><span class="o">.</span><span class="n">time_inds_materialized</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">animatable</span><span class="o">.</span><span class="n">set_state_pre_function_applications</span><span class="p">(</span><span class="n">time_inds</span><span class="o">.</span><span class="n">time_inds_materialized</span><span class="o">.</span><span class="n">amin</span><span class="p">(),</span> <span class="n">time_inds</span><span class="o">.</span><span class="n">time_inds_materialized</span><span class="o">.</span><span class="n">amax</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time_inds_active</span> <span class="o">=</span> <span class="n">time_inds</span><span class="o">.</span><span class="n">time_inds_active</span></div>


<div class="viewcode-block" id="Mob.apply_absolute_change_two">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.apply_absolute_change_two">[docs]</a>
    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;recursive&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_absolute_change_two</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">change1</span><span class="p">,</span> <span class="n">change2</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies an animated change to an attribute, interpolating between two target values.</span>

<span class="sd">        The interpolation first moves from the current value towards `change1`,</span>
<span class="sd">        and if `interpolation` goes beyond 1.0, it then moves from `change1`</span>
<span class="sd">        towards `change2`.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the attribute to change.</span>
<span class="sd">            change1 (Any): The first target value for the attribute.</span>
<span class="sd">            change2 (Any): The second target value for the attribute.</span>
<span class="sd">            interpolation (float, optional): The interpolation factor.</span>
<span class="sd">            recursive (str, optional): If &#39;True&#39;, applies the change recursively</span>
<span class="sd">                to child Mobs. Defaults to &#39;True&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_to_relations</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">interpolation</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">interpolation</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="n">change</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolation</span><span class="p">)</span> <span class="o">+</span> <span class="n">interpolation</span> <span class="o">*</span> <span class="n">change1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">change1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">interpolation</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">interpolation</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">change2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_and_record_modification</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">relation</span><span class="p">(</span><span class="n">current_value</span><span class="p">,</span> <span class="n">change</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">recursive</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">set_time_inds_to</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">change3</span> <span class="o">=</span> <span class="n">change</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">def</span><span class="w"> </span><span class="nf">expand</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">),</span>
                                         <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">x</span>

                    <span class="n">change3</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">repeat_interleave</span><span class="p">(</span><span class="n">expand</span><span class="p">(</span><span class="n">change3</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">apply_relative_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">change3</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.pulse_color">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.pulse_color">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">pulse_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">set_opaque</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Animates a color pulse effect.</span>

<span class="sd">        The Mob&#39;s color changes to the target `color` and then back to its</span>
<span class="sd">        original color.</span>

<span class="sd">        Args:</span>
<span class="sd">            color (torch.Tensor): The color to pulse to.</span>
<span class="sd">            set_opaque (bool, optional): If True, also animates opacity to 1</span>
<span class="sd">                during the pulse. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Sync</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_absolute_change_two</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">set_opaque</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_absolute_change_two</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.wave_color">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.wave_color">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">wave_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">wave_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies a color wave effect across the Mob and its descendants.</span>

<span class="sd">        The color change propagates spatially.</span>

<span class="sd">        Args:</span>
<span class="sd">            color (torch.Tensor): The target color for the wave.</span>
<span class="sd">            wave_length (float, optional): Controls the spatial extent of the wave.</span>
<span class="sd">                Defaults to 1.</span>
<span class="sd">            reverse (bool, optional): If True, the wave propagates in the</span>
<span class="sd">                opposite direction. Defaults to False.</span>
<span class="sd">            direction (torch.Tensor, optional): The 3D vector defining the</span>
<span class="sd">                direction of wave propagation. If None, uses the Mob&#39;s</span>
<span class="sd">                upwards direction. Defaults to None.</span>
<span class="sd">            **kwargs: Additional keyword arguments passed to `pulse_color`</span>
<span class="sd">                for each part of the wave.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_upwards_direction</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">AnimationContext</span><span class="p">(</span><span class="n">run_time_unit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rate_func</span><span class="o">=</span><span class="n">identity</span><span class="p">):</span>
            <span class="n">animate_lagged_by_location</span><span class="p">([</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">()</span> <span class="k">if</span> <span class="n">_</span><span class="o">.</span><span class="n">is_primitive</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">pulse_color</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">direction</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">reverse</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.apply_relative_change">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.apply_relative_change">[docs]</a>
    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;recursive&#39;</span><span class="p">,</span> <span class="s1">&#39;relation_key&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_relative_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">relation_key</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies an animated relative change to an attribute.</span>

<span class="sd">        The `change` is scaled by `interpolation` and then applied to the</span>
<span class="sd">        current attribute value using a predefined relation (e.g., addition</span>
<span class="sd">        for location, multiplication for scale).</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the attribute to change.</span>
<span class="sd">            change (Any): The relative change to apply.</span>
<span class="sd">            interpolation (float, optional): The interpolation factor for the change.</span>
<span class="sd">                Defaults to 1.0.</span>
<span class="sd">            recursive (str, optional): If &#39;True&#39;, applies the change recursively</span>
<span class="sd">                to child Mobs. Defaults to &#39;True&#39;.</span>
<span class="sd">            relation_key (str, optional): The key to look up the relation function</span>
<span class="sd">                (how the change is combined with the current value). Defaults to &quot;None&quot;,</span>
<span class="sd">                which means it uses `key`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">change</span> <span class="o">=</span> <span class="n">change</span> <span class="o">*</span> <span class="n">interpolation</span>
        <span class="n">relation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_to_relations</span><span class="p">[</span><span class="n">relation_key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_and_record_modification</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">relation</span><span class="p">(</span><span class="n">current_value</span><span class="p">,</span> <span class="n">change</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">recursive</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">set_time_inds_to</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">change2</span> <span class="o">=</span> <span class="n">change</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">def</span><span class="w"> </span><span class="nf">expand</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">x</span>
                    <span class="n">change2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">repeat_interleave</span><span class="p">(</span><span class="n">expand</span><span class="p">(</span><span class="n">change2</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">apply_relative_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">change2</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span> <span class="n">relation_key</span><span class="o">=</span><span class="n">relation_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.apply_set_value">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.apply_set_value">[docs]</a>
    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets an attribute&#39;s value, interpolating from its current value to the target `change`.</span>

<span class="sd">        This is a direct interpolation rather than a relative one.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the attribute to set.</span>
<span class="sd">            change (Any): The target value for the attribute.</span>
<span class="sd">            interpolation (float, optional): The interpolation factor.</span>
<span class="sd">                0.0 means no change, 1.0 means the attribute becomes `change`.</span>
<span class="sd">                Defaults to 1.0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">current_value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolation</span><span class="p">)</span> <span class="o">+</span> <span class="n">interpolation</span> <span class="o">*</span> <span class="n">change</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="n">interpolation</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">current_value</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">current_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">interpolation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]):,</span> <span class="p">:])),</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">current_value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolation</span><span class="p">)</span> <span class="o">+</span> <span class="n">interpolation</span> <span class="o">*</span> <span class="n">change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_and_record_modification</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.apply_absolute_change">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.apply_absolute_change">[docs]</a>
    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;recursive&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_absolute_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies an animated absolute change to an attribute, interpolating to a target value.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the attribute to change.</span>
<span class="sd">            change (Any): The target absolute value for the attribute.</span>
<span class="sd">            interpolation (float, optional): The interpolation factor.</span>
<span class="sd">                0.0 means no change from current, 1.0 means attribute becomes `change`.</span>
<span class="sd">                Defaults to 1.0.</span>
<span class="sd">            recursive (str, optional): If &#39;True&#39;, applies the change recursively</span>
<span class="sd">                to child Mobs. Defaults to &#39;True&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orig_value</span> <span class="o">=</span> <span class="n">change</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="n">relation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_to_relations</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">change</span> <span class="o">=</span> <span class="n">current_value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">interpolation</span><span class="p">)</span> <span class="o">+</span> <span class="n">interpolation</span> <span class="o">*</span> <span class="n">change</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="n">interpolation</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">current_value</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="n">current_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]):,:])),</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">change</span> <span class="o">=</span> <span class="n">current_value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolation</span><span class="p">)</span> <span class="o">+</span> <span class="n">interpolation</span> <span class="o">*</span> <span class="n">change</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setattr_and_record_modification</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">relation</span><span class="p">(</span><span class="n">current_value</span><span class="p">,</span> <span class="n">change</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">recursive</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">orig_value</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">set_time_inds_to</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">change2</span> <span class="o">=</span> <span class="n">change</span>
                <span class="n">interpolation2</span> <span class="o">=</span> <span class="n">interpolation</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">def</span><span class="w"> </span><span class="nf">expand</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">),</span>
                                         <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">x</span>

                    <span class="n">change2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">repeat_interleave</span><span class="p">(</span><span class="n">expand</span><span class="p">(</span><span class="n">change2</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interpolation2</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
                        <span class="n">interpolation2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">repeat_interleave</span><span class="p">(</span><span class="n">expand</span><span class="p">(</span><span class="n">interpolation2</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">apply_absolute_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">change2</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation2</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.setattr_basic">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.setattr_basic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setattr_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets an attribute&#39;s value directly without complex animation logic.</span>

<span class="sd">        If the attribute is animatable and an animation context is active,</span>
<span class="sd">        this will still record the change as a step-change.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the attribute to set.</span>
<span class="sd">            value (Any): The new value for the attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_dict_active</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_set_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.setattr_relative">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.setattr_relative">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setattr_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">relation_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets an attribute by applying a relative change.</span>

<span class="sd">        This calculates the difference (`change`) needed to get from the current</span>
<span class="sd">        value to the target `value` based on the inverse relation, then</span>
<span class="sd">        applies that `change` relatively.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the attribute to set.</span>
<span class="sd">            value (Any): The target value for the attribute.</span>
<span class="sd">            relation_key (str, optional): The key for the relation functions.</span>
<span class="sd">                Defaults to `key`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_dict_active</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">relation_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relation_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">rel</span><span class="p">,</span> <span class="n">rel_inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_to_relations</span><span class="p">[</span><span class="n">relation_key</span><span class="p">]</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">change</span> <span class="o">=</span> <span class="n">rel_inv</span><span class="p">(</span><span class="n">current_value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_relative_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span> <span class="k">else</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="n">relation_key</span><span class="o">=</span><span class="n">relation_key</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.setattr_absolute">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.setattr_absolute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setattr_absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets an attribute to an absolute value, animating the transition.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the attribute to set.</span>
<span class="sd">            value (Any): The target absolute value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_dict_active</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_absolute_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span> <span class="k">else</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getattribute_animated</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">)</span>

    <span class="nd">@location</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_relative</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getattribute_animated</span><span class="p">(</span><span class="s1">&#39;basis&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">normalized_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">squish</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coefficient</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_basis_inner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_location</span><span class="p">,</span> <span class="n">old_basis</span><span class="p">,</span> <span class="n">new_basis</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">expand</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">parent_location</span><span class="p">,</span> <span class="n">old_basis</span><span class="p">,</span> <span class="n">new_basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">repeat_interleave</span><span class="p">(</span><span class="n">expand</span><span class="p">(</span><span class="n">_</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="n">parent_location</span><span class="p">,</span> <span class="n">old_basis</span><span class="p">,</span> <span class="n">new_basis</span><span class="p">]]</span>
        <span class="n">local_coords</span> <span class="o">=</span> <span class="n">map_global_to_local_coords</span><span class="p">(</span><span class="n">parent_location</span><span class="p">,</span> <span class="n">old_basis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_and_record_modification</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">map_local_to_global_coords</span><span class="p">(</span><span class="n">parent_location</span><span class="p">,</span> <span class="n">new_basis</span><span class="p">,</span> <span class="n">local_coords</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">set_basis_inner</span><span class="p">(</span><span class="n">parent_location</span><span class="p">,</span> <span class="n">old_basis</span><span class="p">,</span> <span class="n">new_basis</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_basis_interpolated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_basis_interpolated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="s1">&#39;True&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span> <span class="k">else</span> <span class="s1">&#39;False&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Mob._set_basis_interpolated">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob._set_basis_interpolated">[docs]</a>
    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;relation_key&#39;</span><span class="p">,</span> <span class="s1">&#39;recursive&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_set_basis_interpolated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relation_key</span><span class="o">=</span><span class="s1">&#39;basis&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the Mob&#39;s basis, interpolating from the current basis to the target.</span>

<span class="sd">        This method also ensures that child Mobs maintain their positions</span>
<span class="sd">        relative to this Mob during the basis change.</span>

<span class="sd">        Args:</span>
<span class="sd">            basis (torch.Tensor): The target 3x3 basis matrix.</span>
<span class="sd">            interpolation (float, optional): Interpolation factor (0 to 1).</span>
<span class="sd">                Defaults to 1.</span>
<span class="sd">            relation_key (str, optional): Key for the relation function,</span>
<span class="sd">                typically &#39;basis&#39; or &#39;scale_coefficient&#39;. Defaults to &#39;basis&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">recursive</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">(</span><span class="n">include_self</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">set_time_inds_to</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">]</span>
        <span class="n">old_basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;basis&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">basis</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">old_basis</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">interpolation</span><span class="p">)</span> <span class="o">+</span> <span class="n">interpolation</span> <span class="o">*</span> <span class="n">basis</span>
        <span class="n">recursing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span> <span class="o">=</span> <span class="n">recursive</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_relative</span><span class="p">(</span><span class="s1">&#39;basis&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">relation_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span> <span class="o">=</span> <span class="n">recursing</span>
        <span class="k">if</span> <span class="n">recursive</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">set_basis_inner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">old_basis</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="nd">@basis</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_basis_interpolated</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scale_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@scale_coefficient</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scale_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_coefficient</span><span class="p">):</span>
        <span class="n">scale_coefficient</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">scale_coefficient</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_basis_interpolated</span><span class="p">(</span><span class="n">squish</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_coefficient</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">relation_key</span><span class="o">=</span><span class="s1">&#39;scale_coefficient&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Mob.clear_cache">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.clear_cache">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears cached animation data.</span>

<span class="sd">        This is typically used internally when animation states are reset or recalculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attr_to_values_full</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attr_to_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_stamps_full</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_stamps</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_inds_full</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_inds</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Mob.get_normal">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.get_normal">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Alias for get_forward_direction()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_forward_direction</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">get_center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#TODO make this get mid point of bounding box surrounding self + children.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setattr_non_recursive</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Mob.setattr_non_recursive">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.setattr_non_recursive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setattr_non_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets an attribute&#39;s value without applying the change to child Mobs.</span>

<span class="sd">        This temporarily disables the recursive behavior of attribute setting.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The name of the attribute to set.</span>
<span class="sd">            value (Any): The new value for the attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recursing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursing</span> <span class="o">=</span> <span class="n">recursing</span></div>


<div class="viewcode-block" id="Mob.move_to">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_to">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">path_arc_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the Mob to a specified location.</span>

<span class="sd">        If `path_arc_angle` is provided, the Mob moves along an arc.</span>
<span class="sd">        Otherwise, it moves in a straight line.</span>

<span class="sd">        Args:</span>
<span class="sd">            location (torch.Tensor): The target 3D location.</span>
<span class="sd">            path_arc_angle (float, optional): The angle of the arc in degrees</span>
<span class="sd">                for curved movement. If None, movement is linear. Defaults to None.</span>
<span class="sd">            **kwargs: Additional arguments passed to `set_location` or</span>
<span class="sd">                `move_to_point_along_arc`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path_arc_angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_location</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_point_along_arc</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">path_arc_angle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.move">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">displacement</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the Mob by a given displacement vector.</span>

<span class="sd">        Args:</span>
<span class="sd">            displacement (torch.Tensor): The 3D vector by which to move the Mob.</span>
<span class="sd">            **kwargs: Additional arguments passed to `move_to`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">+</span> <span class="n">displacement</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">get_boundary_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_boundary_points_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">num_c</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_points</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">num_c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_boundary_points_recursive</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">get_boundary_points_recursive</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_boundary_edge_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_points_recursive</span><span class="p">()</span>
        <span class="n">best_ind</span> <span class="o">=</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">broadcast_gather</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">best_ind</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_boundary_in_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="n">edge_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_edge_point</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">med</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">mx</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">mn</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">mx</span> <span class="o">+</span> <span class="n">mn</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">med</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">project_point_onto_line</span><span class="p">(</span><span class="n">edge_point</span> <span class="o">-</span> <span class="n">loc</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">loc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_x_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="n">new_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">new_loc</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">new_loc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_y_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="n">new_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">new_loc</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">new_loc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_x_y_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="n">new_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">new_loc</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">new_loc</span>

<div class="viewcode-block" id="Mob.move_next_to">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_next_to">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_next_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mob</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">DEFAULT_BUFFER</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves this Mob to be adjacent to another Mob (or a point) in a given direction.</span>

<span class="sd">        Args:</span>
<span class="sd">            mob (Mob or torch.Tensor): The target Mob or 3D point to move next to.</span>
<span class="sd">            direction (torch.Tensor): The 3D vector indicating the direction</span>
<span class="sd">                from `mob` to this Mob.</span>
<span class="sd">            buffer (float, optional): The distance to maintain between the Mobs.</span>
<span class="sd">                Defaults to DEFAULT_BUFFER.</span>
<span class="sd">            **kwargs: Additional arguments passed to `move_to`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mob_edge</span> <span class="o">=</span> <span class="n">mob</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mob</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="k">else</span> <span class="n">mob</span>
        <span class="n">my_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="o">-</span><span class="n">direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">mob_edge</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">buffer</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">-</span><span class="n">my_edge</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">get_length_in_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="o">-</span><span class="n">direction</span><span class="p">))</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="Mob.move_inline_with_edge">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_inline_with_edge">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_inline_with_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mob</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">DEFAULT_BUFFER</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves this Mob so its edge is aligned with another Mob&#39;s edge along a direction.</span>

<span class="sd">        Args:</span>
<span class="sd">            mob (Mob): The target Mob to align with.</span>
<span class="sd">            direction (torch.Tensor): The primary direction for alignment.</span>
<span class="sd">            edge (torch.Tensor, optional): If specified, this direction is used</span>
<span class="sd">                to determine &quot;which side&quot; of this Mob to use for alignment.</span>
<span class="sd">                If None, `direction` is used. Defaults to None.</span>
<span class="sd">            buffer (float, optional): Buffer distance. Defaults to DEFAULT_BUFFER.</span>
<span class="sd">            **kwargs: Additional arguments for `move`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_loc</span> <span class="o">=</span> <span class="n">Mob</span><span class="p">(</span><span class="n">add_to_scene</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">move_next_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="k">if</span> <span class="n">edge</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">edge</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span><span class="o">.</span><span class="n">location</span>
        <span class="n">new_loc</span> <span class="o">=</span> <span class="n">Mob</span><span class="p">(</span><span class="n">add_to_scene</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">move_next_to</span><span class="p">(</span><span class="n">mob</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span><span class="o">.</span><span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">project_point_onto_line</span><span class="p">(</span><span class="n">new_loc</span> <span class="o">-</span> <span class="n">old_loc</span><span class="p">,</span> <span class="n">direction</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.move_inline_with_center">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_inline_with_center">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_inline_with_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mob</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">DEFAULT_BUFFER</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves this Mob so its center is aligned with another Mob&#39;s center</span>
<span class="sd">        along a given direction.</span>

<span class="sd">        Args:</span>
<span class="sd">            mob (Mob): The target Mob.</span>
<span class="sd">            direction (torch.Tensor): The alignment direction.</span>
<span class="sd">            buffer (float, optional): Buffer distance (seems unused in current impl).</span>
<span class="sd">                                      Defaults to DEFAULT_BUFFER.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">old_loc</span> <span class="o">+</span> <span class="n">project_point_onto_line</span><span class="p">(</span><span class="n">mob</span><span class="o">.</span><span class="n">location</span><span class="o">-</span><span class="n">old_loc</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">move_inline_with_mob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mob</span><span class="p">,</span> <span class="n">align_direction</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_mob</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">DEFAULT_BUFFER</span><span class="p">):</span>
        <span class="n">mob_edge</span> <span class="o">=</span> <span class="n">mob</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="n">align_direction</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">center</span> <span class="k">else</span> <span class="n">mob</span><span class="o">.</span><span class="n">location</span>
        <span class="k">if</span> <span class="n">from_mob</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">from_mob</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">from_edge</span> <span class="o">=</span> <span class="n">from_mob</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="o">-</span><span class="n">align_direction</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">center</span> <span class="k">else</span> <span class="n">from_mob</span><span class="o">.</span><span class="n">location</span>
        <span class="n">displacement</span> <span class="o">=</span> <span class="n">mob_edge</span> <span class="o">-</span> <span class="n">from_edge</span>
        <span class="n">align_direction</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">align_direction</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">dot_product</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">align_direction</span><span class="p">)</span> <span class="o">*</span> <span class="n">align_direction</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_displacement_to_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mob</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="n">my_boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
        <span class="n">other_boundary</span> <span class="o">=</span> <span class="n">mob</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other_boundary</span> <span class="o">-</span> <span class="n">my_boundary</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_inline_with_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mob</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_displacement_to_boundary</span><span class="p">(</span><span class="n">mob</span><span class="p">,</span> <span class="n">direction</span><span class="p">))</span>

<div class="viewcode-block" id="Mob.move_to_edge">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_to_edge">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">DEFAULT_BUFFER</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the Mob to the edge of the screen.</span>

<span class="sd">        Args:</span>
<span class="sd">            edge (torch.Tensor): A 3D vector indicating the screen edge</span>
<span class="sd">                (e.g., RIGHT, LEFT, UP, DOWN).</span>
<span class="sd">            buffer (float, optional): Distance to maintain from the screen border.</span>
<span class="sd">                Defaults to DEFAULT_BUFFER.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_in_direction</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="n">edge_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">project_point_onto_screen_border</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">edge</span><span class="p">)</span>
        <span class="n">target_location</span> <span class="o">=</span> <span class="n">edge_point</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">bp</span> <span class="o">-</span> <span class="n">edge_point</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">buffer</span>
        <span class="n">displacement</span> <span class="o">=</span> <span class="n">target_location</span> <span class="o">-</span> <span class="n">bp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.move_to_corner">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_to_corner">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_corner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge1</span><span class="p">,</span> <span class="n">edge2</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">DEFAULT_BUFFER</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the Mob to a corner of the screen, defined by two edge directions.</span>

<span class="sd">        Args:</span>
<span class="sd">            edge1 (torch.Tensor): Vector for the first screen edge.</span>
<span class="sd">            edge2 (torch.Tensor): Vector for the second screen edge.</span>
<span class="sd">            buffer (float, optional): Distance from the screen borders.</span>
<span class="sd">                Defaults to DEFAULT_BUFFER.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_edge</span><span class="p">(</span><span class="n">edge1</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">)</span><span class="o">.</span><span class="n">move_to_edge</span><span class="p">(</span><span class="n">edge2</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.move_out_of_screen">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_out_of_screen">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_out_of_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">DEFAULT_BUFFER</span><span class="p">,</span> <span class="n">despawn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Animates the Mob moving off-screen in a given edge direction and then despawns it.</span>

<span class="sd">        Args:</span>
<span class="sd">            edge (torch.Tensor): Vector indicating the direction to move off-screen.</span>
<span class="sd">            buffer (float, optional): Additional distance beyond the screen edge.</span>
<span class="sd">                Defaults to DEFAULT_BUFFER.</span>
<span class="sd">            despawn (bool, optional): If True, despawns the Mob after</span>
<span class="sd">                moving it. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_edge_point</span><span class="p">(</span><span class="o">-</span><span class="n">edge</span><span class="p">)</span>
        <span class="n">edge_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">project_point_onto_screen_border</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">edge</span><span class="p">)</span>
        <span class="n">target_location</span> <span class="o">=</span> <span class="n">edge_point</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">bp</span> <span class="o">-</span> <span class="n">edge_point</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">buffer</span>
        <span class="n">displacement</span> <span class="o">=</span> <span class="n">target_location</span> <span class="o">-</span> <span class="n">bp</span>
        <span class="k">with</span> <span class="n">Seq</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">+</span> <span class="n">displacement</span>
            <span class="k">if</span> <span class="n">despawn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">despawn</span><span class="p">(</span><span class="n">animate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.move_to_point_along_square">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_to_point_along_square">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_point_along_square</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">displacement</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the Mob to a destination in a two-step &quot;square&quot; path.</span>
<span class="sd">        First moves by `displacement`, then moves orthogonally to be in line with destination,</span>
<span class="sd">        then moves by `-destination`.</span>

<span class="sd">        Args:</span>
<span class="sd">            destination (torch.Tensor): The final target 3D location.</span>
<span class="sd">            displacement (torch.Tensor): The initial 3D displacement vector.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dest_disp</span> <span class="o">=</span> <span class="n">destination</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">orth_disp</span> <span class="o">=</span> <span class="n">dest_disp</span> <span class="o">-</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">dest_disp</span><span class="p">,</span> <span class="n">dn</span><span class="p">)</span> <span class="o">*</span> <span class="n">dn</span>
        <span class="k">with</span> <span class="n">Seq</span><span class="p">(</span><span class="n">run_time</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">orth_disp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">get_length_along_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="n">all_boundary_points</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">get_boundary_points</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">all_boundary_points</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dots</span> <span class="o">=</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">all_boundary_points</span><span class="p">,</span> <span class="n">direction</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dots</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">dots</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_parts_as_mobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_parts_as_mobs</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">parts</span>

<div class="viewcode-block" id="Mob.scale">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.scale">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales the Mob by a factor `scale_factor` relative to its current scale.</span>

<span class="sd">        Args:</span>
<span class="sd">            scale_factor (float or torch.Tensor): The scaling factor. Can be a scalar or</span>
<span class="sd">                a tensor for per-axis/per-batch scaling.</span>
<span class="sd">            recursive (bool, optional): If True, applies scaling recursively.</span>
<span class="sd">                Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">scale_factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coefficient</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">scale_coefficient</span><span class="o">=</span><span class="n">s</span><span class="p">)</span> <span class="k">if</span> <span class="n">recursive</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_non_recursive</span><span class="p">(</span><span class="n">scale_coefficient</span><span class="o">=</span><span class="n">s</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">set_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">scale_coefficient</span><span class="o">=</span><span class="n">s</span><span class="p">)</span> <span class="k">if</span> <span class="n">recursive</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_non_recursive</span><span class="p">(</span><span class="n">scale_coefficient</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;def set_scale(self, s):</span>
<span class="sd">        with Synchronized():</span>
<span class="sd">            for c in self.children:</span>
<span class="sd">                &quot;&quot;&quot;c.anchors_enabled = False</span>
<span class="sd">                c.local_coord_update_enabled = False</span>
<span class="sd">                disp = (self.location - (c.location + displacement))*s + displacement</span>
<span class="sd">                c.move(disp)</span>
<span class="sd">                c.scale(s, disp)</span>
<span class="sd">                c.local_coord_update_enabled = True</span>
<span class="sd">                c.anchors_enabled = True&quot;&quot;&quot;</span>
<span class="sd">                c.set_scale(s)</span>
<span class="sd">            self.scale_coefficient = s</span>
<span class="sd">        return self&#39;&#39;&#39;</span>

<div class="viewcode-block" id="Mob.rotate">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.rotate">[docs]</a>
    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;num_degrees&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_degrees</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">OUT</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotates the Mob by a number of degrees around a given axis.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_degrees (float or torch.Tensor): The angle of rotation in degrees.</span>
<span class="sd">            axis (torch.Tensor): The 3D axis of rotation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">get_rotation_around_axis</span><span class="p">(</span><span class="n">num_degrees</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">squish</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">@</span> <span class="n">R</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rotate_and_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_degrees</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">num_degrees</span> <span class="o">=</span> <span class="n">num_degrees</span> <span class="o">*</span> <span class="n">interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">num_degrees</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coefficient</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolation</span><span class="p">)</span> <span class="o">+</span> <span class="n">interpolation</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coefficient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Mob.rotate_around_point">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.rotate_around_point">[docs]</a>
    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;num_degrees&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rotate_around_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">num_degrees</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">OUT</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotates the Mob around an arbitrary point in space.</span>

<span class="sd">        Args:</span>
<span class="sd">            point (torch.Tensor): The 3D point to rotate around.</span>
<span class="sd">            num_degrees (float or torch.Tensor): The angle of rotation in degrees.</span>
<span class="sd">            axis (torch.Tensor): The 3D axis of rotation (passing through `point`).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">displacement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">-</span> <span class="n">point</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">rotate_vector_around_axis</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">num_degrees</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="nd">@animated_function</span><span class="p">(</span><span class="n">animated_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;num_degrees&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">unique_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rotate_around_point_non_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">num_degrees</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">OUT</span><span class="p">):</span>
        <span class="n">displacement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">-</span> <span class="n">point</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">rotate_vector_around_axis</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="n">num_degrees</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setattr_non_recursive</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Mob.move_to_point_along_arc">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.move_to_point_along_arc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_point_along_arc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">arc_angle_degrees</span><span class="p">,</span> <span class="n">arc_normal</span><span class="o">=</span><span class="n">OUT</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1">#TODO this is bugged</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the Mob to a target point along a circular arc. ***Currently bugged***</span>

<span class="sd">        Args:</span>
<span class="sd">            point (torch.Tensor): The target 3D location.</span>
<span class="sd">            arc_angle_degrees (float or torch.Tensor): The angle subtended by the arc, in degrees.</span>
<span class="sd">                The sign determines the direction of rotation along the arc.</span>
<span class="sd">            arc_normal (torch.Tensor, optional): The normal vector to the plane</span>
<span class="sd">                of the arc. Defaults to OUT.</span>
<span class="sd">            recursive (bool, optional): If True, applies the rotation recursively</span>
<span class="sd">                to children. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="n">disp_unnnorm</span> <span class="o">=</span> <span class="n">point</span> <span class="o">-</span> <span class="n">my_loc</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="n">disp_unnnorm</span><span class="c1">#F.normalize(disp_unnnorm, p=2, dim=-1)</span>
        <span class="n">disp_normal</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">broadcast_cross_product</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="n">arc_normal</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">angle_sign</span> <span class="o">=</span> <span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">arc_angle_degrees</span><span class="p">)</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span>
        <span class="n">arc_angle_degrees</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arc_angle_degrees</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arc_angle_degrees</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="k">else</span> <span class="n">arc_angle_degrees</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        <span class="n">in1</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">rotate_vector_around_axis</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="n">arc_angle_degrees</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">arc_normal</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">in2</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">rotate_vector_around_axis</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">arc_angle_degrees</span> <span class="o">+</span> <span class="mi">90</span><span class="p">),</span> <span class="n">arc_normal</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">arc_circumference</span> <span class="o">=</span> <span class="n">dot_product</span><span class="p">(</span><span class="o">-</span><span class="n">in1</span><span class="p">,</span> <span class="o">-</span><span class="n">in2</span><span class="p">)</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">arccos_</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(((</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">arc_circumference</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">1e-5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">disp_unnnorm</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1e-5</span><span class="p">))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="c1">#if angle is exactly 180 then below formulas divide by 0, so handle edge case here.</span>
        <span class="n">arc_center1</span> <span class="o">=</span> <span class="p">(</span><span class="n">my_loc</span> <span class="o">+</span> <span class="n">point</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">disp_normal</span><span class="p">),</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">disp</span><span class="p">)</span>
        <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="n">disp_normal</span><span class="p">),</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="n">disp</span><span class="p">)</span>
        <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">in2</span><span class="p">,</span> <span class="n">disp_normal</span><span class="p">),</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">in2</span><span class="p">,</span> <span class="n">disp</span><span class="p">)</span>
        <span class="n">intersect_x</span> <span class="o">=</span> <span class="p">((</span><span class="n">x1</span><span class="o">*</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="o">*</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">-</span><span class="n">x4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="n">y4</span><span class="o">-</span><span class="n">y3</span><span class="o">*</span><span class="n">x4</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">y4</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">-</span><span class="n">x4</span><span class="p">))</span>
        <span class="n">intersect_y</span> <span class="o">=</span> <span class="p">((</span><span class="n">x1</span><span class="o">*</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="o">*</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">y4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="n">y4</span><span class="o">-</span><span class="n">y3</span><span class="o">*</span><span class="n">x4</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">y4</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">-</span><span class="n">x4</span><span class="p">))</span>
        <span class="n">arc_center2</span> <span class="o">=</span> <span class="n">my_loc</span> <span class="o">+</span> <span class="n">intersect_x</span> <span class="o">*</span> <span class="n">disp_normal</span> <span class="o">+</span> <span class="n">intersect_y</span> <span class="o">*</span> <span class="n">disp</span>
        <span class="n">arc_center2</span> <span class="o">=</span> <span class="n">arc_center2</span><span class="o">.</span><span class="n">nan_to_num_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">arc_center</span> <span class="o">=</span> <span class="n">arc_center1</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">arc_center2</span>
        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_around_point</span><span class="p">(</span><span class="n">arc_center</span><span class="p">,</span> <span class="n">arc_circumference</span> <span class="o">*</span> <span class="n">RADIANS_TO_DEGREES</span> <span class="o">*</span> <span class="n">angle_sign</span><span class="p">,</span> <span class="n">arc_normal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_around_point_non_recursive</span><span class="p">(</span><span class="n">arc_center</span><span class="p">,</span> <span class="n">arc_circumference</span> <span class="o">*</span> <span class="n">RADIANS_TO_DEGREES</span> <span class="o">*</span> <span class="n">angle_sign</span><span class="p">,</span> <span class="n">arc_normal</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">():</span>
            <span class="n">_</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">ModificationHistory</span><span class="p">()</span>
            <span class="n">_</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">spawn_time</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detach_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">Off</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">NoExtra</span><span class="p">(</span><span class="n">priority_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">spawn_time</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">old_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">reset_history</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">old_self</span><span class="o">.</span><span class="n">wait</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frames_per_second</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>
                    <span class="n">old_self</span><span class="o">.</span><span class="n">despawn</span><span class="p">(</span><span class="n">animate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_history</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">animate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">expand_n_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">curr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">curr</span> <span class="o">+</span> <span class="n">n</span>
        <span class="n">repeat_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">*</span> <span class="n">curr</span><span class="p">)</span> <span class="o">//</span> <span class="n">target</span>
        <span class="n">split_factors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">repeat_indices</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">curr</span><span class="p">)]</span>
        <span class="n">new_submobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">submob</span><span class="p">,</span> <span class="n">sf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">split_factors</span><span class="p">):</span>
            <span class="n">new_submobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submob</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sf</span><span class="p">):</span>
                <span class="n">new_submobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submob</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">new_submobs</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">expand_n_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points_per_object</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">curr</span> <span class="o">+</span> <span class="n">n</span>
        <span class="n">repeat_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">*</span> <span class="n">curr</span><span class="p">)</span> <span class="o">//</span> <span class="n">target</span>
        <span class="n">split_factors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">repeat_indices</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">curr</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;basis&#39;</span><span class="p">,</span> <span class="s1">&#39;glow&#39;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">attr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">unsquish</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points_per_object</span><span class="p">)</span>
            <span class="n">new_submobs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">submob</span><span class="p">,</span> <span class="n">sf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">split_factors</span><span class="p">):</span>
                <span class="n">new_submobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submob</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sf</span><span class="p">):</span>
                    <span class="n">new_submobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submob</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">submob</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span><span class="o">-</span><span class="mi">2</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points_per_object</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_dict</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">squish</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">new_submobs</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Mob.become">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.become">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">become</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_mob</span><span class="p">,</span> <span class="n">move_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">detach_history</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms this Mob into another Mob (`other_mob`).</span>

<span class="sd">        This involves animating changes in location, opacity, color, basis, etc.,</span>
<span class="sd">        to match `other_mob`. It attempts to match parts of this Mob to parts</span>
<span class="sd">        of `other_mob` for a smoother transition, especially for complex Mobs.</span>

<span class="sd">        Args:</span>
<span class="sd">            other_mob (Mob): The Mob to transform into.</span>
<span class="sd">            move_to (bool, optional): If True, explicitly moves this Mob to</span>
<span class="sd">                `other_mob`&#39;s location as part of the transformation.</span>
<span class="sd">                (The current implementation seems to always align attributes</span>
<span class="sd">                including location). Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The (transformed) Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO When doing become multiple times into Text despawn, the triangles are fadedout out in the wrong order</span>

        <span class="k">with</span> <span class="n">Off</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">detach_history</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">detach_history</span><span class="p">()</span>
                <span class="n">other_mob_original</span> <span class="o">=</span> <span class="n">other_mob</span>
                <span class="n">other_mob</span> <span class="o">=</span> <span class="n">other_mob</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">add_to_scene</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="c1">#.detatch_history()</span>

            <span class="n">child_diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_mob</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_n_children</span><span class="p">(</span><span class="n">child_diff</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">other_mob</span><span class="o">.</span><span class="n">expand_n_children</span><span class="p">(</span><span class="o">-</span><span class="n">child_diff</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">Seq</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">Sync</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">my_c</span><span class="p">,</span> <span class="n">other_c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">other_mob</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
                    <span class="n">my_c</span><span class="o">.</span><span class="n">become</span><span class="p">(</span><span class="n">other_c</span><span class="p">,</span> <span class="n">detach_history</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">other_mob</span><span class="o">.</span><span class="n">num_points_per_object</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points_per_object</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;You are trying to change an object of one primitive type (e.g. triangle) to another type (e.g. cubic bezier circuit), this it not supported. When using become() the target mob must be of the same type as the original.&quot;</span><span class="p">)</span>
                <span class="n">batch_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">other_mob</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points_per_object</span>
                <span class="k">if</span> <span class="n">batch_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">expand_n_batch</span><span class="p">(</span><span class="n">batch_diff</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">batch_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">other_mob</span><span class="o">.</span><span class="n">expand_n_batch</span><span class="p">(</span><span class="o">-</span><span class="n">batch_diff</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;basis&#39;</span><span class="p">,</span> <span class="s1">&#39;glow&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setattr_non_recursive</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other_mob</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">detach_history</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">Off</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">despawn</span><span class="p">(</span><span class="n">animate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">other_mob_original</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">animate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="c1">#self.detach_history()</span>
            <span class="k">return</span> <span class="bp">self</span></div>

        <span class="c1">#with Off():</span>
        <span class="c1">#    self.despawn(animate=False)</span>
        <span class="c1">#    return other_mob_original.detach_history()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_become_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_mob</span><span class="p">,</span> <span class="n">move_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">other_c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">other_mob</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="n">my_c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">Sync</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_c</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">Off</span><span class="p">():</span>
                        <span class="n">new_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">animate_creation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">other_c</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">my_c</span><span class="p">):]]</span>
                        <span class="n">my_c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_c</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_children</span><span class="p">(</span><span class="n">new_c</span><span class="p">)</span>
                        <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">set_recursive</span><span class="p">(</span><span class="n">local_coords</span><span class="o">=</span><span class="n">ORIGIN</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">new_c</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_c</span><span class="p">):</span>
                    <span class="n">my_c</span> <span class="o">=</span> <span class="n">my_c</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">other_c</span><span class="p">)]</span>
                <span class="p">[</span><span class="n">my_c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_become_recursive</span><span class="p">(</span><span class="n">other_c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">move_to</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_c</span><span class="p">)))]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">move_to</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>

            <span class="n">other_loc</span> <span class="o">=</span> <span class="n">other_mob</span><span class="o">.</span><span class="n">location</span>
            <span class="n">my_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
            <span class="n">my_n</span> <span class="o">=</span> <span class="n">my_loc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">other_n</span> <span class="o">=</span> <span class="n">other_loc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">other_n</span> <span class="o">&gt;</span> <span class="n">my_n</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">Off</span><span class="p">(</span><span class="n">record_funcs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">record_attr_modifications</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setattr_regular</span><span class="p">(</span><span class="s1">&#39;_location&#39;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">my_loc</span><span class="p">,</span> <span class="n">my_loc</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">other_n</span> <span class="o">-</span> <span class="n">my_n</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span> <span class="o">=</span> <span class="n">other_mob</span><span class="o">.</span><span class="n">parent_batch_sizes</span>
            <span class="k">elif</span> <span class="n">other_n</span> <span class="o">&lt;</span> <span class="n">my_n</span><span class="p">:</span>
                <span class="n">other_loc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">other_loc</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">other_loc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">my_n</span><span class="o">-</span><span class="n">other_n</span><span class="p">,</span> <span class="n">other_loc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))),</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">other_loc</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Mob.set_non_recursive">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.set_non_recursive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_non_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets multiple attributes non-recursively (i.e., only for this Mob, not children).</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments where keys are attribute names and</span>
<span class="sd">                values are the new values for those attributes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Sync</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setattr_non_recursive</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mob.set">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.set">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets multiple attributes, applying changes recursively to children by default.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Keyword arguments where keys are attribute names and values are the new values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        Examples</span>
<span class="sd">        ---------</span>

<span class="sd">        .. algan:: Example1MobSet</span>

<span class="sd">            from algan import *</span>

<span class="sd">            mob = Square().spawn()</span>
<span class="sd">            mob.set(location=RIGHT, color=BLUE)</span>

<span class="sd">            render_to_file()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Sync</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">set_recursive_from_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">cast_to_tensor</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">((</span><span class="n">x</span><span class="p">,))</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_inds_materialized</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">time_inds_materialized</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_state_full</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">time_inds_materialized</span><span class="o">.</span><span class="n">amin</span><span class="p">(),</span> <span class="n">parent</span><span class="o">.</span><span class="n">time_inds_materialized</span><span class="o">.</span><span class="n">amax</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_inds_active</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">time_inds_active</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">repeat_interleave</span><span class="p">(</span><span class="n">cast_to_tensor</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">with</span> <span class="n">AnimationContext</span><span class="p">(</span><span class="n">dont_record_funcs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_recursive</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">set_recursive_from_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Mob.get_forward_direction">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.get_forward_direction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_forward_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the Mob&#39;s current forward direction vector (normalized).</span>
<span class="sd">        This is the third column of its normalized basis matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The 3D forward vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">,:],</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.get_right_direction">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.get_right_direction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_right_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the Mob&#39;s current right direction vector (normalized).</span>
<span class="sd">        This is the first column of its normalized basis matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The 3D right vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.get_upwards_direction">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.get_upwards_direction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_upwards_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the Mob&#39;s current upwards direction vector (normalized).</span>
<span class="sd">        This is the second column of its normalized basis matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: The 3D upwards vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.look">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.look">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">look</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotates the Mob so that one of its local axes points in the given direction.</span>

<span class="sd">        Args:</span>
<span class="sd">            direction (torch.Tensor): The target 3D direction vector.</span>
<span class="sd">            axis (int, optional): The index of the local axis to align.</span>
<span class="sd">                0 for right, 1 for up, 2 for forward.</span>
<span class="sd">                Defaults to 2 (forward vector).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">*</span><span class="n">get_rotation_between_3d_vectors</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalized_basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="n">axis</span><span class="p">,:],</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">look_and_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_and_scale</span><span class="p">(</span><span class="o">*</span><span class="n">get_rotation_between_3d_vectors</span><span class="p">(</span><span class="n">unsquish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalized_basis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="n">axis</span><span class="p">,:],</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">scale</span><span class="p">)</span>

<div class="viewcode-block" id="Mob.look_at">
<a class="viewcode-back" href="../../../reference/algan.mobs.mob.Mob.html#algan.mobs.mob.Mob.look_at">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">look_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks in the direction from this mobs location to the given point.</span>
<span class="sd">        The Mob&#39;s &quot;forward&quot; direction ok`&#39;s default axis)</span>
<span class="sd">        will be oriented towards the point.</span>

<span class="sd">        Args:</span>
<span class="sd">            point (torch.Tensor): The 3D point to look at.</span>
<span class="sd">            axis (int, optional): The index of the local axis to align.</span>
<span class="sd">                0 for right, 1 for up, 2 for forward.</span>
<span class="sd">                Defaults to 2 (forward vector).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: The Mob instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">point</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">look</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">spawn_tilewise_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">tiles</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">traverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">())</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="s1">&#39;tiles&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">time_inds</span><span class="o">.</span><span class="n">created</span><span class="p">)]</span>
        <span class="k">with</span> <span class="n">AnimationContext</span><span class="p">(</span><span class="n">run_time</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">animate_lagged_by_location</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">spawn_from_random_direction</span><span class="p">(),</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">RIGHT</span> <span class="o">*</span> <span class="mf">1.5</span> <span class="o">+</span> <span class="n">DOWN</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">despawn_tilewise_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">tiles</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">traverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">())</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="s1">&#39;tiles&#39;</span><span class="p">)]</span>
        <span class="k">with</span> <span class="n">AnimationContext</span><span class="p">(</span><span class="n">run_time</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">animate_lagged_by_location</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">despawn_from_random_direction</span><span class="p">(),</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">RIGHT</span> <span class="o">*</span> <span class="mf">1.5</span> <span class="o">+</span> <span class="n">DOWN</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">spawn_from_random_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">travel_distance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">Off</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_recursive</span><span class="p">(</span><span class="n">animate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">Sync</span><span class="p">(</span><span class="n">run_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rate_func</span><span class="o">=</span><span class="n">ease_out_exp</span><span class="p">):</span>
            <span class="c1">#self.location = loc</span>
            <span class="c1">#self.rotate(720, F.normalize(torch.randn_like(self.location), p=2, dim=-1))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mi">1</span><span class="c1">#set_recursive(opacity=1)</span>
            <span class="c1">#with Synchronized(run_time=2, rate_func=tan):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">despawn_from_random_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">travel_distance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">Sync</span><span class="p">(</span><span class="n">run_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rate_func</span><span class="o">=</span><span class="n">inversed</span><span class="p">(</span><span class="n">ease_out_exp</span><span class="p">)):</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
            <span class="c1">#self.location = loc + torch.randn_like(loc) * travel_distance</span>
            <span class="c1">#self.rotate(720, F.normalize(torch.randn_like(self.location), p=2, dim=-1))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">#set_recursive(opacity=0)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_destroy_recursive</span><span class="p">(</span><span class="n">animate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># with Synchronized(run_time=2, rate_func=tan):</span>
            <span class="c1">#self.destroy()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_data_sub_inds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_sub_inds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sub_pbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">[</span><span class="n">data_sub_inds</span><span class="p">]</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span><span class="p">])</span>
            <span class="n">data_sub_inds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">inds</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_sub_inds</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_sub_inds</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="k">else</span> <span class="n">inds</span><span class="p">[</span><span class="n">data_sub_inds</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sub_pbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_sub_inds</span> <span class="o">=</span> <span class="n">data_sub_inds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_batch_sizes</span> <span class="o">=</span> <span class="n">sub_pbs</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">set_data_sub_inds</span><span class="p">(</span><span class="n">data_sub_inds</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows accessing a part of a batched Mob using slice notation.</span>

<span class="sd">        Returns a new Mob instance that represents the specified sub-part(s),</span>
<span class="sd">        sharing animation data but with `data_sub_inds` set appropriately.</span>

<span class="sd">        Args:</span>
<span class="sd">            item (int or slice): The index or slice for the batch dimension.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mob: A new Mob representing the selected part(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">add_to_scene</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clone_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">animate_creation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_data_sub_inds</span><span class="p">([</span><span class="n">item</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025-2025, Algorithmic Simplicity
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/manim-binder.min.js?v=29f72615"></script>
    <script>window.initManimBinder({branch: "v0.1.0"})</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../_static/responsiveSvg.js?v=f1528c9d"></script>
    </body>
</html>